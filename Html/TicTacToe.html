<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tic Tac Toe</title>

    <script src="https://kit.fontawesome.com/4b5542137e.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../hCss/ttt.css">
</head>
<body>

<br>
<!--back arrow to index page-->
<a class="l-arrow btn btn-dark" href="../index.html">
    <i class="fa fa-arrow-left"></i>
</a>
<div id="title">
    <h1>Tic Tac Toe</h1>
</div>

<div id="whoseTurn">

</div>
<br>
<div class="ticTacToe-board-2" id="t-board">
    <br>
    <table class="tb-table">
        <tr class="row-1">
            <td id="b0" class="tb" onclick="checkPlayerTurn()"></td>
            <td id="b1" class="tb" onclick="checkPlayerTurn()"></td>
            <td id="b2" class="tb" onclick="checkPlayerTurn()"></td>
        </tr>

        <tr class="row-2">
            <td id="b3" class="tb" onclick="checkPlayerTurn()"></td>
            <td id="b4" class="tb" onclick="checkPlayerTurn()"></td>
            <td id="b5" class="tb" onclick="checkPlayerTurn()"></td>
        </tr>
        <tr class="row3">
            <td id="b6" class="tb" onclick="checkPlayerTurn()"></td>
            <td id="b7" class="tb" onclick="checkPlayerTurn()"></td>
            <td id="b8" class="tb" onclick="checkPlayerTurn()"></td>
        <tr>
    </table>
</div>

<!--<br>
<br>
<br>
<hr>
<div class="ticTacToe-board">
    <div id="board_0" class="t-board"></div>
    <div id="board_1" class="t-board"></div>
    <div id="board_2" class="t-board"></div>
    <div id="board_3" class="t-board"></div>
    <div id="board_4" class="t-board"></div>
    <div id="board_5" class="t-board"></div>
    <div id="board_6" class="t-board"></div>
    <div id="board_7" class="t-board"></div>
    <div id="board_8" class="t-board"></div>
</div>-->

<a class="btn btn-outline-dark" onclick="startGame()">Start Game</a>
<a class="btn btn-outline-dark" onclick="reset()">Reset</a>


<script>
    //used to identify the turn of the human player
    let person = 0;
    //used to identify the turn of the computer player
    let comp = 0;
    //used to identify whether start game was pressed
    let pressed = false;

    //represents whose turn it is
    //integer value represents whether it is player 1 or 2's turn
    let currentTurn = 1;

    //boolean representing whether the game has ended
    let gameEnd = false;

    //function to start the tic tac toe game
    function startGame() {
        //if pressed is false set pressed to true and start game
        if (pressed === false) {
            pressed = true;

            //generates a random positive integer number between 1 and 10
            let rand = Math.floor(Math.random() * (10 - 1) + 1);

            //if the remainder of the random positive integer when mod by 2 is 0 then
            //the human is player number 2
            if (rand % 2 === 0) {

                //adding on to the html element whose ID is title
                //adds what player number the human user is to the screen
                document.getElementById("title").innerHTML += "<h3>You are Player 2</h3>";

                //writes whose turn it is to the div with the id whoseTurn
                //currently the Enemy's turn as it is player 1 based on the if statement above
                document.getElementById("whoseTurn").innerHTML = "<h2>Enemy Turn</h2>";

                //setting the player number status of the human and computer
                person = 2;
                comp = 1;

                //calling function compTurn to get the computers move
                compTurn(comp);
            } else {
                //adding on to the html element whose ID is title
                //adds what player number the human user is to the screen
                document.getElementById("title").innerHTML += "<h3>You are Player 1</h3>";

                //writes whose turn it is to the div with the id whoseTurn
                //currently the Players turn as it is player 1 based on the else statement
                document.getElementById("whoseTurn").innerHTML = "<h2>Your Turn</h2>";

                //setting the player number status of the human and computer
                person = 1;
                comp = 2;

                //calling function personTurn to get the humans move
                //does not call checkPlayerTurn as it is known that it is the human players turn
                personTurn(person);
            }
        }
    }

    //function to check if it is the human players turn
    //helper to see if personTurn needs to be called
    function checkPlayerTurn() {
        //checking if the variable currentTurn is equal to person
        //person represents the player number of the human
        if (currentTurn === person) {
            //if it is the humans turn the function personTurn is called
            personTurn(person);
        }
    }

    function personTurn(sym) {
        document.getElementById("t-board").style.cursor = "pointer";
        document.getElementById("whoseTurn").innerHTML = "<h2>Your Turn</h2>";
        let board = Math.floor(Math.random() * 9);
        let letter;
        let op;
        let comp;

        if (sym === 1) {
            comp = 2;
        } else {
            comp = 1;
        }

        if (sym === 1) {
            letter = "X";
            op = "O"
        } else {
            letter = "O";
            op = "O";
        }

        if (document.getElementById("b" + board).innerText === "") {
            //document.getElementById("b" + board).textContent = letter;
            currentTurn = comp;
            document.getElementById("t-board").style.cursor = "";
            //compTurn(comp);
        } else {
            checkEnd();
            personTurn(sym);
        }
        checkEnd();
    }

    function compTurn(sym) {
        document.getElementById("whoseTurn").innerHTML += "<h2>Enemy Turn</h2>";
        let board = Math.floor(Math.random() * 9);
        let letter;
        let op;
        let helpPerson;

        if (sym === 1) {
            helpPerson = 2;
        } else {
            helpPerson = 1;
        }

        if (sym === 1) {
            letter = "X";
            op = "O"
        } else {
            letter = "O";
            op = "O";
        }

        if (document.getElementById("b" + board).innerText === "") {
            document.getElementById("b" + board).textContent = letter;
            currentTurn = helpPerson;
            checkPlayerTurn();
        } else {
            checkEnd();
            compTurn(sym);
        }
        checkEnd();
    }

    //function to determine whether the game has ended or not
    //TODO: determine who won the game
    function checkEnd() {
        //retrieving all cells in the board that have the className tb
        let boards = document.getElementsByClassName("tb");

        //denotes the number of cells filled
        let currFilled = 0;

        //loop through the list of board cells stored in variable board
        for (let i = 0; i < boards.length; i++) {
            //checking if the innerText of the cell is not empty
            if (boards[i].innerText !== "") {
                //if it is not empty then 1 is added to the variable currFilled
                currFilled += 1;
            }
        }

        //if all cells are filled then the game is over
        //TODO: update so that game is also over if player/comp wins before board is full
        if (currFilled === 9) {
            document.getElementById("t-board").innerHTML = "<h3>GAME OVER!</h3> <h3>IT'S A TIE</h3>"
        }
    }

    //function reset is used to reset the board when the game has ended or when the human player
    // wishes to start a new game regardless of whether the game has ended
    function reset() {
        //changes the variable representing whether start game was pressed or not to false
        pressed = false;

        //this line is used to remove what player number the human player is from the element with the id title
        document.getElementById("title").innerHTML = "<h1>Tic Tac Toe</h1>"

        //this line ensures that the element with the id whoseTurn displays nothing
        // as it is no ones turn when the game has not started
        document.getElementById("whoseTurn").innerHTML = "";


        //when the game has ended the board is removed by text that says the game ended and who won
        //this re-writes the board to be used for another game
        if (gameEnd === true) {
            document.getElementById("t-board").innerHTML = "<br>\n" +
                "    <table class=\"tb-table\">\n" +
                "        <tr class=\"row-1\">\n" +
                "            <td id=\"b0\" class=\"tb\"></td>\n" +
                "            <td id=\"b1\" class=\"tb\"></td>\n" +
                "            <td id=\"b2\" class=\"tb\"></td>\n" +
                "        </tr>\n" +
                "\n" +
                "        <tr class=\"row-2\">\n" +
                "            <td id=\"b3\" class=\"tb\"></td>\n" +
                "            <td id=\"b4\" class=\"tb\"></td>\n" +
                "            <td id=\"b5\" class=\"tb\"></td>\n" +
                "        </tr>\n" +
                "        <tr class=\"row3\">\n" +
                "            <td id=\"b6\" class=\"tb\"></td>\n" +
                "            <td id=\"b7\" class=\"tb\"></td>\n" +
                "            <td id=\"b8\" class=\"tb\"></td>\n" +
                "        <tr>"
        } else {
            //if the game has not ended when reset is pressed
            //loop through all the board cells and empty their text content
            for (let i = 0; i < 10; i++) {
                document.getElementById("b" + i).textContent = "";
            }
        }
    }
</script>

</body>
</html>